Può capitare di dover esportare dalla propria web application dati nell'amato/odiato formato di mamma Microsoft.<br/><br/>Di solito utilizzavo una soluzione 'sporca': realizzavo la pagina in modo da visualizzare una semplice tabella html contenente i dati e aggiungevo in testa allo script un bel<br/><blockquote> header("Content-Disposition:attachment;filename=file.xls");</blockquote><br/>facendo in modo che il browser salvasse la pagina così creata con estensione .xls.<br/><br/>Excel riusciva a leggere senza problemi l'html e visualizzava la tabella mantenendo anche la formattazione.<br/><br/>In giro sul web trovo però quest'<a href="http://www.appservnetwork.com/modules.php?name=News&amp;file=article&amp;sid=8">altro metodo</a>, che permette di salvare direttamente in formato excel, senza strani giri.<br/><br/>Si creano quindi delle funzioni adatte alla formattazione:<br/><blockquote><font color="#007700">function </font><font color="#0000bb">xlsBOF</font><font color="#007700">() {<br/>echo </font><font color="#0000bb">pack</font><font color="#007700">(</font><font color="#dd0000">"ssssss"</font><font color="#007700">, </font><font color="#0000bb">0x809</font><font color="#007700">, </font><font color="#0000bb">0x8</font><font color="#007700">, </font><font color="#0000bb">0x0</font><font color="#007700">, </font><font color="#0000bb">0x10</font><font color="#007700">, </font><font color="#0000bb">0x0</font><font color="#007700">, </font><font color="#0000bb">0x0</font><font color="#007700">);<br/>return;<br/>}</font><br/><br/><font color="#007700">function </font><font color="#0000bb">xlsEOF</font><font color="#007700">() {<br/>echo </font><font color="#0000bb">pack</font><font color="#007700">(</font><font color="#dd0000">"ss"</font><font color="#007700">, </font><font color="#0000bb">0x0A</font><font color="#007700">, </font><font color="#0000bb">0x00</font><font color="#007700">);<br/>return;<br/>}</font><br/><br/><font color="#007700">function </font><font color="#0000bb">xlsWriteNumber</font><font color="#007700">(</font><font color="#0000bb">$Row</font><font color="#007700">, </font><font color="#0000bb">$Col</font><font color="#007700">, </font><font color="#0000bb">$Value</font><font color="#007700">) {<br/>echo </font><font color="#0000bb">pack</font><font color="#007700">(</font><font color="#dd0000">"sssss"</font><font color="#007700">, </font><font color="#0000bb">0x203</font><font color="#007700">, </font><font color="#0000bb">14</font><font color="#007700">, </font><font color="#0000bb">$Row</font><font color="#007700">, </font><font color="#0000bb">$Col</font><font color="#007700">, </font><font color="#0000bb">0x0</font><font color="#007700">);<br/>echo </font><font color="#0000bb">pack</font><font color="#007700">(</font><font color="#dd0000">"d"</font><font color="#007700">, </font><font color="#0000bb">$Value</font><font color="#007700">);<br/>return;<br/>}</font><br/><br/><font color="#007700">function </font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">$Row</font><font color="#007700">, </font><font color="#0000bb">$Col</font><font color="#007700">, </font><font color="#0000bb">$Value </font><font color="#007700">) {<br/></font><font color="#0000bb">$L </font><font color="#007700">= </font><font color="#0000bb">strlen</font><font color="#007700">(</font><font color="#0000bb">$Value</font><font color="#007700">);<br/>echo </font><font color="#0000bb">pack</font><font color="#007700">(</font><font color="#dd0000">"ssssss"</font><font color="#007700">, </font><font color="#0000bb">0x204</font><font color="#007700">, </font><font color="#0000bb">8 </font><font color="#007700">+ </font><font color="#0000bb">$L</font><font color="#007700">, </font><font color="#0000bb">$Row</font><font color="#007700">, </font><font color="#0000bb">$Col</font><font color="#007700">, </font><font color="#0000bb">0x0</font><font color="#007700">, </font><font color="#0000bb">$L</font><font color="#007700">);<br/>echo </font><font color="#0000bb">$Value</font><font color="#007700">;<br/>return;<br/>}</font></blockquote><br/>Dopodichè si richiamano nella creazione del file (nell'esempio vengono pescati i dati da un database):<br/><blockquote><font color="#ff8000">// Query Database<br/></font><font color="#0000bb">$result</font><font color="#007700">=</font><font color="#0000bb">mysql_db_query</font><font color="#007700">(</font><font color="#0000bb">$dbname</font><font color="#007700">,</font><font color="#dd0000">"select id,prename,name,sname,grade from appdata where course='$courseid' and sec='$section'"</font><font color="#007700">)</font><br/><br/><font color="#ff8000">// Send Header<br/></font><font color="#0000bb">header</font><font color="#007700">(</font><font color="#dd0000">"Pragma: public"</font><font color="#007700">);<br/></font><font color="#0000bb">header</font><font color="#007700">(</font><font color="#dd0000">"Expires: 0"</font><font color="#007700">);<br/></font><font color="#0000bb">header</font><font color="#007700">(</font><font color="#dd0000">"Cache-Control: must-revalidate, post-check=0, pre-check=0"</font><font color="#007700">);<br/></font><font color="#0000bb">header</font><font color="#007700">(</font><font color="#dd0000">"Content-Type: application/force-download"</font><font color="#007700">);<br/></font><font color="#0000bb">header</font><font color="#007700">(</font><font color="#dd0000">"Content-Type: application/octet-stream"</font><font color="#007700">);<br/></font><font color="#0000bb">header</font><font color="#007700">(</font><font color="#dd0000">"Content-Type: application/download"</font><font color="#007700">);;<br/></font><font color="#0000bb">header</font><font color="#007700">(</font><font color="#dd0000">"Content-Disposition: attachment;filename=$courseid-$sec.xls</font><font color="#007700"> </font><font color="#dd0000">"</font><font color="#007700">);</font><font color="#ff8000"><br/></font><font color="#0000bb">header</font><font color="#007700">(</font><font color="#dd0000">"Content-Transfer-Encoding: binary "</font><font color="#007700">);</font><br/><br/><font color="#ff8000">// XLS Data Cell</font><br/><br/><font color="#0000bb">xlsBOF</font><font color="#007700">();<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">1</font><font color="#007700">,</font><font color="#0000bb">0</font><font color="#007700">,</font><font color="#dd0000">"Student Register $semester/$year"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">2</font><font color="#007700">,</font><font color="#0000bb">0</font><font color="#007700">,</font><font color="#dd0000">"COURSENO : "</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">2</font><font color="#007700">,</font><font color="#0000bb">1</font><font color="#007700">,</font><font color="#dd0000">"$courseid"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">3</font><font color="#007700">,</font><font color="#0000bb">0</font><font color="#007700">,</font><font color="#dd0000">"TITLE : "</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">3</font><font color="#007700">,</font><font color="#0000bb">1</font><font color="#007700">,</font><font color="#dd0000">"$title"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">4</font><font color="#007700">,</font><font color="#0000bb">0</font><font color="#007700">,</font><font color="#dd0000">"SETION : "</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">4</font><font color="#007700">,</font><font color="#0000bb">1</font><font color="#007700">,</font><font color="#dd0000">"$sec"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">6</font><font color="#007700">,</font><font color="#0000bb">0</font><font color="#007700">,</font><font color="#dd0000">"NO"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">6</font><font color="#007700">,</font><font color="#0000bb">1</font><font color="#007700">,</font><font color="#dd0000">"ID"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">6</font><font color="#007700">,</font><font color="#0000bb">2</font><font color="#007700">,</font><font color="#dd0000">"Gender"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">6</font><font color="#007700">,</font><font color="#0000bb">3</font><font color="#007700">,</font><font color="#dd0000">"Name"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">6</font><font color="#007700">,</font><font color="#0000bb">4</font><font color="#007700">,</font><font color="#dd0000">"Lastname"</font><font color="#007700">);<br/></font><font color="#0000bb">$xlsRow </font><font color="#007700">= </font><font color="#0000bb">7</font><font color="#007700">;<br/>while(list(</font><font color="#0000bb">$id</font><font color="#007700">,</font><font color="#0000bb">$prename</font><font color="#007700">,</font><font color="#0000bb">$name</font><font color="#007700">,</font><font color="#0000bb">$sname</font><font color="#007700">,</font><font color="#0000bb">$grade</font><font color="#007700">)=</font><font color="#0000bb">mysql_fetch_row</font><font color="#007700">(</font><font color="#0000bb">$result</font><font color="#007700">)) {<br/>++</font><font color="#0000bb">$i</font><font color="#007700">;<br/></font><font color="#0000bb">xlsWriteNumber</font><font color="#007700">(</font><font color="#0000bb">$xlsRow</font><font color="#007700">,</font><font color="#0000bb">0</font><font color="#007700">,</font><font color="#dd0000">"$i"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteNumber</font><font color="#007700">(</font><font color="#0000bb">$xlsRow</font><font color="#007700">,</font><font color="#0000bb">1</font><font color="#007700">,</font><font color="#dd0000">"$id"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">$xlsRow</font><font color="#007700">,</font><font color="#0000bb">2</font><font color="#007700">,</font><font color="#dd0000">"$prename"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">$xlsRow</font><font color="#007700">,</font><font color="#0000bb">3</font><font color="#007700">,</font><font color="#dd0000">"$name"</font><font color="#007700">);<br/></font><font color="#0000bb">xlsWriteLabel</font><font color="#007700">(</font><font color="#0000bb">$xlsRow</font><font color="#007700">,</font><font color="#0000bb">4</font><font color="#007700">,</font><font color="#dd0000">"$sname"</font><font color="#007700">);<br/></font><font color="#0000bb">$xlsRow</font><font color="#007700">++;<br/>}<br/></font><font color="#0000bb">xlsEOF</font><font color="#007700">();<br/>exit();</font></blockquote><br/>Semplice e indolore... :-)