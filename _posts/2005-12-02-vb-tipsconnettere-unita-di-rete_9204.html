---
layout: post
title: VB Tips:Connettere unita' di rete
date: '2005-12-02T00:12:00.001+01:00'
author: Andrea Fortuna
tags:
- VB.NET
- Programmazione
modified_time: '2012-04-26T14:24:31.127+02:00'
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-5641023597115018088
blogger_orig_url: http://www.andreafortuna.org/2005/12/vb-tipsconnettere-unita-di-rete_9204.html
---

Mi e' capitato, durante la realizzazione di un software 'di servizio', di dover far 'mappare' un unita' di rete al software e fargli copiare un file sulla suddetta unita' .<br/><br/>Non volendo optare per uno 'sporco' shell "net use... ho fatto qualche ricerca tra le API di windows:<a name='more'></a><br/><br/><strong><blockquote><strong>Public Declare Function WNetAddConnection2 Lib "mpr.dll" Alias<br/>"WNetAddConnection2A" (lpNetResource As NETRESOURCE, ByVal lpPassword As String,<br/>ByVal lpUserName As String, ByVal dwFlags As Long) As Long </strong><br/></blockquote></strong><br/><br/>Questa funzione permette di connettere un'unita' di rete<br/><br/><br/><strong><blockquote><strong>Public Declare Function WNetCancelConnection2 Lib "mpr.dll" Alias<br/>"WNetCancelConnection2A" (ByVal lpName As String, ByVal dwFlags As Long, ByVal<br/>fForce As Long) As Long</strong> </blockquote></strong><br/><br/><br/>Questa invece viene utilizzata per disconnettere l'unita' .<br/><br/><br/>A questo punto il passo e' breve:<br/>Creo un nuovo modulo, dichiaro qualche costante, le API e due funzioni per sfruttarle:<br/><br/><strong><blockquote><strong>Option Explicit<br/><br/><br/>Const CONNECT_UPDATE_PROFILE = &amp;H1<br/><br/><br/>Const RESOURCE_CONNECTED As Long = &amp;H1&amp;<br/>Const<br/>RESOURCE_GLOBALNET As Long = &amp;H2&amp;<br/>Const RESOURCETYPE_DISK As Long =<br/>&amp;H1&amp;<br/>Const RESOURCEDISPLAYTYPE_SHARE&amp; = &amp;H3<br/>Const<br/>RESOURCEUSAGE_CONNECTABLE As Long = &amp;H1&amp;<br/><br/><br/><br/>Declare<br/>Function WNetAddConnection2 Lib "mpr.dll" _<br/>Alias "WNetAddConnection2A"<br/>(lpNetResource As NETCONNECT, _<br/>ByVal lpPassword As String, ByVal lpUserName<br/>As String, _<br/>ByVal dwFlags As Long) As Long<br/><br/><br/>Declare Function<br/>WNetCancelConnection2 Lib "mpr.dll" _<br/>Alias "WNetCancelConnection2A" (ByVal<br/>lpName As String, _<br/>ByVal dwFlags As Long, _<br/>ByVal fForce As Long) As<br/>Long<br/><br/><br/>Type NETCONNECT<br/>dwScope As Long<br/>dwType As Long<br/>dwDisplayType As Long<br/>dwUsage As Long<br/>lpLocalName As String<br/>lpRemoteName As String<br/>lpComment As String<br/>lpProvider As String<br/>End Type<br/>Public Function DisconnectDrive(LocalDrive As String) As<br/>Boolean<br/><br/><br/><br/>Dim NetR As NETCONNECT<br/><br/><br/>'Utilizzo:<br/>'DisconnectDrive "Q:"<br/><br/><br/>DisconnectDrive =<br/>(WNetCancelConnection2(LocalDrive, 0, 1))<br/>End Function<br/><br/><br/><br/>Function MapDrive(LocalDrive As String, _<br/>RemoteDrive As<br/>String, Optional Username As String, _<br/>Optional Password As String) As<br/>Boolean<br/><br/><br/>'Utilizzo:<br/>'MapDrive "Q:",<br/>"RemoteMachineRemoteDirectory","MyLoginName", "MyPassword"<br/><br/><br/><br/>Dim<br/>NetR As NETCONNECT<br/><br/><br/>NetR.dwScope = RESOURCE_GLOBALNET<br/>NetR.dwType<br/>= RESOURCETYPE_DISK<br/>NetR.dwDisplayType = RESOURCEDISPLAYTYPE_SHARE<br/>NetR.dwUsage = RESOURCEUSAGE_CONNECTABLE<br/>NetR.lpLocalName =<br/>Left$(LocalDrive, 1) &amp; ":"<br/>NetR.lpRemoteName = RemoteDrive<br/>MapDrive<br/>= (WNetAddConnection2(NetR, Username, Password, _<br/>CONNECT_UPDATE_PROFILE) =<br/>0)<br/><br/><br/><br/>End Function<br/></strong></blockquote></strong><br/><br/>A questo punto, la copia del file risulta semplice, utilizzando il comando<br/>FileCopy [origine], [destinazione]