---
layout: post
title: ASP.NET - Upload di un file
date: '2006-02-13T17:05:00.001+01:00'
author: Andrea Fortuna
tags:
- Programmazione
- ASP.NET
- C#
modified_time: '2012-04-26T14:23:57.572+02:00'
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-628946700056188431
blogger_orig_url: http://www.andreafortuna.org/2006/02/aspnet-upload-di-un-file_13.html
---

<p>Quando ripenso a quanto fosse necessario penare con il vecchio ASP 3.0 per effettuare l&#8217;upload di un file sul WebServer mi vengono i brividi.</p><br/><a name='more'></a><br/>	<p>Per fortuna Microsoft ha ascoltato le preghiere dei programmatori disperati e in ASP.NET ha inserito delle classi apposite per l&#8217;upload, rendendo il tutto semplice quasi quanto in PHP.</p><br/> <a></a><br/><p>Per prima cosa, e&#8217; necessario un FORM html, nel quale dobbiamo modificare il tag <strong>&lt;form&gt;</strong> ed impostare un encoding che sar&agrave; <strong>multipart/form-data</strong>.<br />Questo encoding serve per specificare che durante il submit del form verranno spediti una sequenza di dati chepoi verranno interpretati. </p><br/><br/>	<p>Abbiamo bisogno inoltre di un tag &lt;INPUT&gt; con proprieta&#8217; <strong><em>file</em></strong>: creera&#8217; il pulsante &#8216;Sfoglia&#8217; sul nostro form, necessario all&#8217;apertura della finestra di ricerca file.</p><br/>	<p>Il codice del form sara&#8217; quindi il seguente:</p><br/><br/>	<blockquote><p>&lt;form id=&quot;Upload&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; runat=&quot;server&quot;&gt;<br />&lt;input type=&quot;file&quot; runat=&quot;server&quot; id=&quot;PostedFile&quot;&gt;<br />&lt;asp:Button Runat=&quot;server&quot; ID=&quot;Send&quot; Text=&quot;Invia&quot; /&gt;<br />&lt;/form&gt;</p></blockquote><br/><br/>	<p>e questo il risultato:</p><br/>	<p><img width="262" height="29" border="0" alt="" src="http://www.andreafortuna.net/wp-content/upload.png" />&nbsp;</p><br/>	<p>&nbsp;</p><br/>	<p>Nel Code-Behind dovremo quindi associare del codice alla pressione del pulsante &#8216;Invia&#8217;:</p><br/>	<p>&nbsp;</p><br/>	<blockquote><p>private void Send_Click(object sender,&nbsp; System.EventArgs e)<br />{</p><br/><br/>	<p>&nbsp;&nbsp;&nbsp; HttpPostedFile file_sent=PostedFile.PostedFile;</p><br/>	<p>&nbsp;&nbsp;&nbsp; //Rilevazione delle dimensioni del file inviato<br />&nbsp;&nbsp;&nbsp; int file_size=file_sent.ContentLength;</p><br/>	<p>&nbsp;&nbsp;&nbsp; byte[] dati=new byte[file_size];</p><br/>	<p>&nbsp;&nbsp;&nbsp; //Lettura dal file e riempimento del buffer<br />&nbsp;&nbsp;&nbsp; file_sent.InputStream.Read(dati, 0, file_size);</p><br/><br/>	<p>&nbsp;&nbsp;&nbsp; string filename = file_sent.FileName;</p><br/>	<p>&nbsp;&nbsp;&nbsp; //Scrittura del File su disco<br />&nbsp;&nbsp;&nbsp; FileStream fs=new FileStream(&quot;C:\\&quot; + Path.GetFileName(filename),FileMode.Create);<br />&nbsp;&nbsp;&nbsp; fs.Write(dati,0,file_size);<br />&nbsp;&nbsp;&nbsp; fs.Close();<br />}</p></blockquote>