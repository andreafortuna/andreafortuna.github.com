---
layout: post
title: Ruby e i Thread
date: '2005-12-18T09:12:00.001+01:00'
author: Andrea Fortuna
tags:
- Ruby
modified_time: '2012-04-26T14:24:31.136+02:00'
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-6055023264841395935
blogger_orig_url: http://www.andreafortuna.org/2005/12/ruby-e-i-thread_18.html
---

<p>Ruby include un supporto nativo al threading sulla falsariga di quello presente nel linguaggio Java, che implementa il supporto alla programmazione concorrente direttamente nel linguaggio. </p><p>Il supporto ai thread in Ruby e' pero' il risultato dell'implementazione di questa tecnologia direttamente nell'interprete del linguaggio, senza passare dai thread del sistema operativo: questo tipo di soluzione porta vantaggi ma anche lati negativi. </p><p>Uno dei maggiori vantaggi consiste nella portabilita': non basandosi sui thread nativi del sistema operativo, il threading di ruby non e' soggetto a funzionamenti diversi in base al sistema operativo 'ospitante'. </p><a name='more'></a><p>D'altra parte, il principale svantaggio consiste nella relativa 'giovinezza' del linguaggio: il supporto per il threading e' ancora immaturo, e spesso comporta problemi di <em>dead-lock</em> e <em>starvation</em>. </p><p>Problemi citati a parte, l'utilizzo dei thread in ruby e' di una semplicita' disarmante.Per creare nuovi thread e' necessario richiamare il metodo <em>new</em> della classe <em>Thread</em>:</p><blockquote><p>Thread.new( [arg]* ) { | args | block |}</p></blockquote><p>Il metodi si aspetta un parametro (o gruppo di parametri) e il blocco di codice da eseguire.Ad esempio:</p><blockquote><p>x = Thread.new { sleep .1; print "x"; print "y"; print "z"}y = Thread.new { print "1"; print "2"; print "3"}</p></blockquote><p>Appena creato, il thread parte con l'esecuzione del blocco di codice specificato. La possibilita' di passare parametri e' basilare per fornire al thread dati sui quali operare.</p><p>Un esempio concreto dell'utilizzo del threading potrebbe essere un semplice <em>Echo Server</em>: il programma si mette in ascolto su una porta TPC e appena un client si collega gli restituisce la prima stringa inviata e chiude la connessione. Implementando questo programma con i thread, i server potra' accettare piu' connessioni contemporaneamente.</p><blockquote><p>require "socket"</p><p>echo_server = TCPServer.new(1234) </p><p>while true  socket = echo_server.accept  Thread.start do    puts "Connessione avvenutan"    s = socket    line = s.gets    puts "Linea Ricevuta:" + line + "n"       s.puts line + "n"    s.close  endend</p></blockquote><p>Vediamo il codice nel dettaglio:</p><blockquote><p>require "socket"</p></blockquote><p>include la libreria <em>socket</em>, necessaria per la creazione del server TCP.</p><blockquote><p>echo_server = TCPServer.new(1234)</p></blockquote><p>Crea  un'istanza della classe TCPServer, aprendo un socket in ascolto sulla porta 1234.</p><blockquote><p>while true  socket = echo_server.accept</p></blockquote><p>Inizia un ciclo infinito e si mette in attesa di connessioni.</p><blockquote><p>Thread.start do    puts "Connessione avvenutan"    s = socket    line = s.gets    puts "Linea Ricevuta:" + line + "n"       s.puts line + "n"    s.close  endend</p></blockquote><p>Questo e' il <em>cuore</em> del nostro programma: appena viene stabilita la connessione, viene avviato un nuovo Thread (la sintassi e' leggermente diversa dagli esempi precendenti, il tutto per rendere migliore la leggibilita' in quando il blocco di codice da eseguire nel thread e' piu' <em>nutrito</em>) nel quale viene attesa una stringa dal client e, una volta ricevuta, viene reinviata al client stesso e chiusa la connessione. </p><p>Tutto questo blocco di codice viene eseguito come un 'processo' separato: infatti, appena creato il thread, il ciclo ricomincia dall'inizio e il server si rimette in attesa di un'altra connessione, senza dover aspettare che il client invii la sua stringa.</p><p>L'esempio e' estremamente semplice, non e' ad oggetti e ignora completamente le eccezioni, ma spero permetta di capire a grandi linee il funzionamento del threading:nei miei prossimi interventi sull'argomento tratteremo appunto la gestione delle eccezioni, l'enumerazione e la manipolazione dei Thread.</p><p> </p>