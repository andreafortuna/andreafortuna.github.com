---
layout: post
title: Sessioni NetBios Nulle
date: '2007-12-07T10:44:00.001+01:00'
author: Andrea Fortuna
tags:
- Sicurezza
- Windows
- security
modified_time: '2012-04-26T14:21:39.134+02:00'
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-6146719144008982502
blogger_orig_url: http://www.andreafortuna.org/2007/12/sessioni-netbios-nulle_07.html
---

<span>La <em>NetBios Null Session</em> è un meccanismo che consente ad un utente non autenticato di ottenere informazioni su un host remoto.<br/>Nei sistemi Windows (Nt,2000,XP e 2003), buona parte dei servizi locali sono eseguiti con l'account SYSTEM utilizzato anche per varie operazioni critiche di sistema.<br/>Proprio per la criticita' delle operazioni che va a svolgere, tale account ha privilegi praticamente illimitati e non richiede alcuna password, proprio per evitare che venga utilizzato per effettuare il LogIn .</span><br/><br/><span>Qualora l'utente SYSTEM avesse bisogno di accedere ad altre macchine in rete, avra' necessita' di reperire alcune informazioni, come le condivisioni disponibili e gli utenti. Non essendo un reale account con user&amp;pass, si connettera' utilizzando appunto una sessione nulla, funzione implementata nel sistema di networking di windows proprio per questo scopo.</span><br/><br/><span>Le sessioni NetBios nulle permettono quindi di sfruttare le funzionalita’ del protocollo SMB (Server Message Block) senza stabilire preventivamente una <em>trust relationship</em>.<br/>Sfortunatamente anche un eventuale aggressore puo' connettersi utilizzando una Sessione Nulla. :-)</span><br/><br/><span>Riassumendo, con una sessione nulla possiamo ottenere:</span><br/><ul><br/><li class="MsoNormal">Lista di gruppi e utenti</li><br/><li class="MsoNormal">Lista di hosts collegati</li><br/><li class="MsoNormal">Lista delle condivisioni</li><br/><li class="MsoNormal">SID (Security Identifiers) di      utenti e host</li><br/></ul><br/><span>Le sessioni NetBios NULL sono abilitate di default su Windows 2000 e NT.<br/>Windows XP e 2003 permettono di recuperare l’elenco degli share, ma non degli accounts.</span><br/><br/><span>Un tool per effettuare un test sulle sessioni nulle NetBios e’ <strong>HUNT.</strong></span><br/><br/><span>Parte dell’</span><a href="http://www.foundstone.com/us/resources/proddesc/forensic-toolkit.htm"><span>NT Forensic Toolkit realizzato</span></a><span> da Foundstone, rende molto semplice realizzare l’elenco di utenti e shares su un host windows.</span><br/><br/><span>Un esempio di output del programma:</span><br/><p class="MsoNormal" style="margin-left:0.5in;">C:\tools&gt;hunt \\&lt;IP Address&gt;</p><br/><p class="MsoNormal" style="margin-left:0.5in;">share = IPC$ - Remote IPC</p><br/><p class="MsoNormal" style="margin-left:0.5in;">share = c -</p><br/><p class="MsoNormal" style="margin-left:0.5in;">share = ADMIN$ - Remote Admin</p><br/><p class="MsoNormal" style="margin-left:0.5in;">share = C$ - Default share</p><br/><p class="MsoNormal" style="margin-left:0.5in;">User = Administrator, , , Built-in account for administering the computer/domain</p><br/><p class="MsoNormal" style="margin-left:0.5in;">Admin is &lt;NetBIOS Name&gt;\Administrator</p><br/><p class="MsoNormal" style="margin-left:0.5in;">User = Guest, , , Built-in account for guest access to the computer/domain</p><br/><p class="MsoNormal" style="margin-left:0.5in;">User = IUSR_&lt;NetBIOS Name&gt;, Internet Guest Account, Built-in account for anonymous access to Internet Information Services, Built-in account for anonymous access to Internet Information Services</p><br/><p class="MsoNormal" style="margin-left:0.5in;">User = IWAM_&lt;NetBIOS Name&gt;, Internet Guest Account, Built-in account for anonymous access to Internet Information Services out of process applications, Built-in account for anonymous access to Internet Information Services out of process applications</p><br/><p class="MsoNormal" style="margin-left:0.5in;">User = victim_user Victim Name, ,</p><br/><span>Altro tool a mio avviso molto utile e’ <strong>winfo</strong> ( </span><a href="http://ntsecurity.nu/toolbox/winfo/"><span>http://ntsecurity.nu/toolbox/winfo/</span></a><span> )</span><br/><br/><span>Si tratta di una utility da riga di commando che recupera dall’host la maggior parte delle informazioni ottenibili da una sessione nulla, complete le trust relationships.<br/>Un esempio di output:</span><br/><br/><p style="margin-left:0.5in;"><span class="style1"><span>C:\&gt;winfo xxx.xxx.xxx.xxx –n </span></span><span><br/><span class="style1">winfo 1.5 - copyright (c) 1999-2001, Arne Vidstrom </span><br/><span class="style1">- http://www.ntsecurity.nu/toolbox/winfo/</span><br/>Trying to establish null session...<br/></span>Null session established.<br/><blockquote>USER ACCOUNTS:<br/>* Administrator<br/>(This account is the built-in administrator account)<br/>* Guest<br/>(This account is the built-in guest account)<br/>* victim_user</blockquote><br/></p><p class="style11" style="margin-left:0.5in;">WORKSTATION TRUST ACCOUNTS:</p><br/><p class="style11" style="margin-left:0.5in;">INTERDOMAIN TRUST ACCOUNTS:</p><br/><p class="style11" style="margin-left:0.5in;">SERVER TRUST ACCOUNTS:</p><br/><p class="style11" style="margin-left:0.5in;">SHARES:</p><br/><p class="style11" style="margin-left:0.5in;">* IPC$</p><br/><p class="style11" style="margin-left:0.5in;"><span>* drivec$</span></p><br/><p class="style11" style="margin-left:0.5in;"><span>(ecc…)</span></p><br/><strong><span>Utilita’ delle sessioni nulle per un eventuale attacker</span></strong><span><br/>Senza avere accesso alla macchina e’ possibile conoscere gli shares e gli eventuali utenti che possono accedervi.</span><br/><br/><span>Un eventuale malintenzionato puo’ in quel caso avere un elenco di account sui quali concentrarsi: una volta reperite le credenziali di uno degli account elencati potra’ avere accesso allo share che lo interessa.</span><br/><p class="MsoNormal"><span>Fortunatamente da Windows XP in poi questa 'perdita di informazioni' e' stata in parte limitata rendendo di default non possibile l'enumerazione degli utenti.</span></p><br/><strong><span>Disabilitare le sessione NetBios nulle</span></strong><span><br/>I controller di dominio per comunicare richiedono sessioni nulle.<br/>Perciò, se state lavorando in un dominio di rete, potete limitare la quantità di informazioni fornite, ma non eliminarle del tutto.</span><br/><br/><span>N.B.: applicare limitazioni sulle sessioni nulle nei domain controller e su altri server specifici può compromettere alcune normali operazioni di rete.<br/>E' consigliabile quindi effettuare questa configurazione solo se la macchina in questione e' particolarmente esposta a rischi. Tutte le altre macchine dovrebbero essere protette da un firewall configurato per bloccare NetBIOS e CIFS.</span><br/><br/><span>Di seguito le procedure per la limitazione delle sessioni nulle sui vari sistemi operativi:</span><br/><br/><strong><span>Windows XP Professional</span></strong><span> <strong>(valido anche per Windows 2000 e XP Home)</strong></span><br/><br/><p style="margin-left:0.5in;"><span>1. Modificare la seguente chiave di registro:<br/>HKLM/System/CurrentControlSet/Control/LSA/RestrictAnonymous=2</span><br/></p><p style="margin-left:0.5in;"><span>2. Riavviare il sistema</span></p><br/><strong><span>Windows Server 2003 </span></strong><span></span><br/><br/><p style="margin-left:0.5in;">1. Aprire Administrative Tools --&gt; Local Security Policy --&gt; Local Policies --&gt; Security Options. Verificare che le seguenti <em>policy</em> siano abilitate:<br/>Network Access: Do not allow anonymous enumeration of SAM accounts: Enabled <em>(Default)<br/></em>Network Access: Do not allow anonymous enumeration of SAM accounts and shares: Enabled<br/><br/></p><p style="margin-left:0.5in;"><span>La stessa operazione puo’ essere effettuata modificando le seguenti chiavi nel registro di configurazione:<br/>HKLM\System\CurrentControlSet\Control\Lsa\RestrictAnonymous=1 <em>(Disabilita l’enumerazione degli share)<br/></em>HKLM\System\CurrentControlSet\Control\Lsa\RestrictAnonymousSAM=1 <em>(Impostazione di default: non permette l’enumerazione degli accounts) </em></span><br/></p><p style="margin-left:0.5in;">2.Riavviare il sistema</p><br/><strong>Windows 2000 </strong><br/><p class="MsoNormal" style="margin-left:0.5in;">1. Aprire --&gt; Administrative Tools --&gt; Local Security Settings --&gt; Local Policies --&gt; Security Options</p><br/><p class="MsoNormal" style="margin-left:0.5in;">2. Selezionare "Additional restrictions of anonymous connections" nel pannello Policy sulla destra</p><br/><p style="margin-left:0.5in;">3. Dal menu "Local policy setting", selezionare: "No access without explicit anonymous permissions"</p><br/><p style="margin-left:0.5in;"><span>4. Premere OK</span></p><br/><p class="MsoNormal" style="margin-left:0.5in;"><span>5. L’equivalente modifica dal registro di configurazione: HKLM\System\CurrentControlSet\Control\Lsa\RestrictAnonymous=2</span></p><br/><p class="MsoNormal" style="margin-left:0.5in;"><span>6. Riavviare il sistema.</span></p><br/><p class="MsoNormal"><strong> Windows NT 4.0 (Service Pack 3 o superiore)</strong></p><br/><br/><p class="MsoNormal" style="margin-left:0.75in;text-indent:-0.25in;"><!--[if !supportLists]--><span><span>1.<span style="font-family:'Times New Roman';font-style:normal;font-variant:normal;font-weight:normal;font-size:7pt;line-height:normal;">      </span></span></span><!--[endif]--><span>Modificare la chiave di registro:<br/>HKLM/System/CurrentControlSet/Control/LSA/RestrictAnonymous=1</span><br/></p><p class="MsoNormal" style="margin-left:0.75in;text-indent:-0.25in;"><!--[if !supportLists]--><span><span>2.<span style="font-family:'Times New Roman';font-style:normal;font-variant:normal;font-weight:normal;font-size:7pt;line-height:normal;">      </span></span></span><!--[endif]--><span>Riavviare il sistema</span></p><br/><p class="MsoNormal"><span> </span></p><br/><p class="MsoNormal"><span> </span></p><br/><p class="MsoNormal"><span> </span></p>