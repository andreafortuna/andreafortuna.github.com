---
layout: post
title: I consigli di Arvid Norberg per la realizzazione di software ad alte prestazioni
date: '2014-05-22T10:00:00.000+02:00'
author: Andrea Fortuna
tags:
- Programming
modified_time: '2014-05-22T10:00:25.153+02:00'
thumbnail: http://2.bp.blogspot.com/-B_oqVH0t_tI/U32tXo4KOsI/AAAAAAAAKF4/bgnex4R47g4/s72-c/IMG_20140522_095233.jpg
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-4108735820175837624
blogger_orig_url: http://oldsite.andreafortuna.org/2014/05/i-consigli-di-arvid-norberg-per-la.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-B_oqVH0t_tI/U32tXo4KOsI/AAAAAAAAKF4/bgnex4R47g4/s1600/IMG_20140522_095233.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-B_oqVH0t_tI/U32tXo4KOsI/AAAAAAAAKF4/bgnex4R47g4/s1600/IMG_20140522_095233.jpg" height="150" /></a></div><a href="https://www.linkedin.com/pub/arvid-norberg/2/977/ab8" target="_blank">Arvid Norberg</a>, forte della lunga esperienza acquisita sulla sviluppo di <a href="https://www.utorrent.com/" target="_blank">uTorrent</a>, ha stilato sul <a href="http://blog.libtorrent.org/">blog di libtorrent</a> una interessante <a href="http://blog.libtorrent.org/2012/12/principles-of-high-performance-programs/" target="_blank"> lista di principi</a> per lo sviluppo di programmi ad alte prestazioni.<br /><br />Li riassumo brevemente, e vi consiglio vivamente di leggere integralmente il post originale.<br /><br /><!-- more --><a name='more'></a><br />A suo dire, le due cause fondamentali di problemi di prestazioni sono:<br /><ol><li><b>Latenza della memoria.</b> Un grosso problema di prestazioni nei computer moderni è la latenza della <i>SDRAM</i>. La CPU resta parecchio tempo inattiva in attesa che l'operazione di lettura dalla RAM venga completata.</li><li><b><a href="http://www.dizionarioinformatico.com/cgi-lib/diz.cgi?frame&amp;key=contexts">Context Switching</a>.</b> Quando una CPU commuta contesto la memoria a cui accederà probabilmente non sara' correlata alla memoria del contesto precedente. Ciò comporta la necessita' di  svuotare la cache precedente, obbligando il processo legato al nuovo context a caricare i relativi dati dalla RAM, rallentandone l'esecuzione.</li></ol>Propone anche 7 regole per migliorare le prestazioni:<br /><ol style="text-align: left;"><li><b>Lavorare su logica batch.</b> Evitare il Context Switching. Ad esempio, esistono versioni <i>vettoriali </i>di chiamate di sistema come <b>writev</b>() e <b>readv</b>() che operano in più di un elemento per ogni chiamata in modo da raggruppare il maggior numero di scritture possibili.</li><li><b>Evitare i Magic Numbers</b>.&nbsp;Non sono scalabili. Svegliare un <i>thread </i>ogni 100ms o quando 100 jobs sono in coda, oppure utilizzando buffer di dimensione fissa, mal si adatta al mutare delle circostanze.</li><li><b>Allocare i buffer di memoria in anticipo</b>, per evitare copie superflue e mantenere prevedibile l'utilizzo della memoria.</li><li><b>Adattare organicamente</b> le dimensioni delle code dei jobs per mantenere la granularità dello scheduler e il tempo necessario al risveglio del thread.</li><li><b>Adattare le dimensioni del buffer di ricezione dei socket</b>, evitando allo stesso tempo gli sconfinamenti di memoria <i>out-of-the-kernel</i>.</li><li><b>Attendere sempre il completamento di tutti i lavori in coda</b> di un thread prima di rimetterlo in <i>sleep.</i></li><li><b>Svegliare un thread </b>solo quando il numero di jobs nella sua coda di lavoro passa da 0 a &gt;0. Qualsiasi altro risveglio è ridondante e uno spreco di tempo.</li></ol>Parte di questi concetti sono presenti anche in questa ottima presentazione (sempre di Norberg), intitolata <b>Writing High-Performance Software</b>:<br /><br /><br /><center><iframe allowfullscreen="" frameborder="0" height="356" marginheight="0" marginwidth="0" scrolling="no" src="http://www.slideshare.net/slideshow/embed_code/30767629" style="border-width: 1px 1px 0; border: 1px solid #CCC; margin-bottom: 5px; max-width: 100%;" width="427"> </iframe> <br /></center></div>