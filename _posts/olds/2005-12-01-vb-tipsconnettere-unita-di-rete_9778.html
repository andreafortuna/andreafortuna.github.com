---
layout: post
title: VB Tips:Connettere unita' di rete
date: '2005-12-01T16:48:00.001+01:00'
author: Andrea Fortuna
tags:
- Programming
modified_time: '2012-04-26T14:24:31.084+02:00'
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-257529443095163562
blogger_orig_url: http://oldsite.andreafortuna.org/2005/12/vb-tipsconnettere-unita-di-rete_9778.html
---

Mi e' capitato, durante la realizzazione di un software 'di servizio', di dover far 'mappare' un unita' di rete al software e fargli copiare un file sulla suddetta unita' .<br/><br/>Non volendo optare per uno 'sporco' shell "net use... ho fatto qualche ricerca tra le API di windows:<br/><br/>[sourcecode language="vb"]<br/>Public Declare Function WNetAddConnection2 Lib &quot;mpr.dll&quot; Alias<br/>&quot;WNetAddConnection2A&quot; (lpNetResource As NETRESOURCE, ByVal lpPassword As String,<br/>ByVal lpUserName As String, ByVal dwFlags As Long) As Long<br/>[/sourcecode]<br/><br/>Questa funzione permette di connettere un'unita' di rete<br/><br/>[sourcecode language="vb"]<br/>Public Declare Function WNetCancelConnection2 Lib &quot;mpr.dll&quot; Alias<br/>&quot;WNetCancelConnection2A&quot; (ByVal lpName As String, ByVal dwFlags As Long, ByVal<br/>fForce As Long) As Long<br/>[/sourcecode]<br/><br/>Questa invece viene utilizzata per disconnettere l'unita' .<br/><br/>A questo punto il passo e' breve:<br/>Creo un nuovo modulo, dichiaro qualche costante, le API e due funzioni per sfruttarle:<br/><br/>[sourcecode language="vb"]<br/>Option Explicit<br/>Const CONNECT_UPDATE_PROFILE = &amp;H1<br/><br/>Const RESOURCE_CONNECTED As Long = &amp;H1<br/>Const RESOURCE_GLOBALNET As Long = &amp;H2<br/>Const RESOURCETYPE_DISK As Long = &amp;H1<br/>Const RESOURCEDISPLAYTYPE_SHARE&amp; = &amp;H3<br/>Const RESOURCEUSAGE_CONNECTABLE As Long = &amp;H1<br/><br/>Declare Function WNetAddConnection2 Lib &quot;mpr.dll&quot; _<br/>Alias &quot;WNetAddConnection2A&quot;<br/>(lpNetResource As NETCONNECT, _<br/>ByVal lpPassword As String, ByVal lpUserName<br/>As String, _<br/>ByVal dwFlags As Long) As Long<br/><br/>Declare Function<br/>WNetCancelConnection2 Lib &quot;mpr.dll&quot; _<br/>Alias &quot;WNetCancelConnection2A&quot; (ByVal<br/>lpName As String, _<br/>ByVal dwFlags As Long, _<br/>ByVal fForce As Long) As<br/>Long<br/><br/>Type NETCONNECT<br/>dwScope As Long<br/>dwType As Long<br/>dwDisplayType As Long<br/>dwUsage As Long<br/>lpLocalName As String<br/>lpRemoteName As String<br/>lpComment As String<br/>lpProvider As String<br/>End Type<br/>Public Function DisconnectDrive(LocalDrive As String) As<br/>Boolean<br/><br/>Dim NetR As NETCONNECT<br/><br/>'Utilizzo:<br/>'DisconnectDrive &quot;Q:&quot;<br/><br/>DisconnectDrive =<br/>(WNetCancelConnection2(LocalDrive, 0, 1))<br/>End Function<br/><br/>Function MapDrive(LocalDrive As String, _<br/>RemoteDrive As<br/>String, Optional Username As String, _<br/>Optional Password As String) As<br/>Boolean<br/><br/>'Utilizzo:<br/>'MapDrive &quot;Q:&quot;,<br/>&quot;RemoteMachineRemoteDirectory&quot;,&quot;MyLoginName&quot;, &quot;MyPassword&quot;<br/><br/>Dim<br/>NetR As NETCONNECT<br/><br/>NetR.dwScope = RESOURCE_GLOBALNET<br/>NetR.dwType<br/>= RESOURCETYPE_DISK<br/>NetR.dwDisplayType = RESOURCEDISPLAYTYPE_SHARE<br/>NetR.dwUsage = RESOURCEUSAGE_CONNECTABLE<br/>NetR.lpLocalName = Left$(LocalDrive, 1) &amp; &quot;:&quot;<br/>NetR.lpRemoteName = RemoteDrive<br/>MapDrive = (WNetAddConnection2(NetR, Username, Password, CONNECT_UPDATE_PROFILE) = 0)<br/><br/>End Function<br/>[/sourcecode]<br/><br/>A questo punto, la copia del file risulta semplice, utilizzando il comando<br/>FileCopy [origine], [destinazione]