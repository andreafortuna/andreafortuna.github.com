---
layout: post
title: 'HTML5: applicare effetti in realtime al flusso video della webcam'
date: '2013-06-14T10:24:00.000+02:00'
author: Andrea Fortuna
tags:
- webcam
- JavaScript
- html5
- WebRTC
modified_time: '2013-06-17T15:30:44.526+02:00'
thumbnail: http://4.bp.blogspot.com/-fRs66uWgw2g/Ua3q75tCA-I/AAAAAAAAFOM/kjiv2GFrnL4/s72-c/Schermata+2013-06-04+alle+15.24.41.png
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-7333281738721639900
blogger_orig_url: http://oldsite.andreafortuna.org/2013/06/html5-applicare-effetti-in-realtime-al.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-fRs66uWgw2g/Ua3q75tCA-I/AAAAAAAAFOM/kjiv2GFrnL4/s1600/Schermata+2013-06-04+alle+15.24.41.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="146" src="http://4.bp.blogspot.com/-fRs66uWgw2g/Ua3q75tCA-I/AAAAAAAAFOM/kjiv2GFrnL4/s200/Schermata+2013-06-04+alle+15.24.41.png" width="200" /></a></div>In un precedente post ho spiegato come utilizzare WebRTC per accedere alle immagini acquisite dalla webcam.<br /><br /><br />Oggi estendiamo il progetto e cerchiamo di applicare degli effetti in realtime al video.<br /><br /><a name='more'></a><br />La prima domanda che mi si potrebbe porre è: perchè non utilizzare i <a href="http://www.w3.org/TR/2013/WD-filter-effects-20130523/" target="_blank">Filtri CSS</a>?<br />Per un motivo semplice: il demo che voglio sviluppare, oltre ad applicare gli effetti al flusso video della webcam si occupa anche di salvarne degli <i>snapshot</i>.<br />I filtri CSS vengono applicati <i>sopra</i>&nbsp;il canvas/video, non ne modificano il contenuto: sono in pratica delle <i>maschere</i>&nbsp;che non alterano il contenuto dell'oggetto e che verrebbero ignorate in fase di salvataggio.<br /><br />La soluzione che ho ideato è tuttavia abbastanza pesante per quanto concerne l'utilizzo delle risorse: <i>senza dubbio ci sono grandi margini di ottimizzazione</i>.<br /><br />In pratica utilizzo il codice del <a href="http://oldsite.andreafortuna.org/2013/06/html5-accedere-alla-webcam.html" target="_blank">precedente post</a> per dirottare il flusso multimediale della webcam su un oggetto <i>VIDEO </i>nascosto, successivamente avvio un ciclo che 30 volte al secondo realizza uno snapshot del video, applica i filtri sull'immagine ottenuta e la copia sull'oggetto <i>CANVAS</i>.<br /><br />Il codice per la realizzazione dei filtri (righe 8-52) e la loro applicazione sull'immagine (righe 59-67) l'ho tratto da questo <a href="http://www.storminthecastle.com/2013/04/06/how-you-can-do-cool-image-effects-using-html5-canvas" target="_blank">ottimo articolo</a> di&nbsp;<a href="http://www.storminthecastle.com/" target="_blank">John Robinson</a>.<br /><br /><br /><script src="https://gist.github.com/andreafortuna/747030abf55e6569d066.js"></script> <br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://demo.andreafortuna.org/HTML5CanvasEffects/" imageanchor="1" style="margin-left: auto; margin-right: auto;" target="_blank"><img border="0" src="http://4.bp.blogspot.com/--a636JhrqsA/UaxSqfKXRkI/AAAAAAAAFNU/YBpXvRkMxA4/s1600/DEMO.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Compatibile con Safari, Chrome e Firefox</td></tr></tbody></table>