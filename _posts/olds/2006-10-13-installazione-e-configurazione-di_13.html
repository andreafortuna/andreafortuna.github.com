---
layout: post
title: Installazione e Configurazione di Asterisk con VoipStunt su OpenWRT
date: '2006-10-13T12:15:00.001+02:00'
author: Andrea Fortuna
tags:
- Technology
modified_time: '2012-04-26T14:23:36.501+02:00'
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-756842337765515837
blogger_orig_url: http://oldsite.andreafortuna.org/2006/10/installazione-e-configurazione-di_13.html
---

OpenWRT e' senza dubbio un bel giocattolino: su un 'semplice' linksys WRT54GL abbiamo la possibilita' di installare parecchi software utili come server Web, server DNS e anche applicazioni piu' corpose come il PBX asterisk.<br/><br/>Prendiamo in esame una semplice configurazione con 2 interni e la possibilita' di effettuare chiamate in uscita tramite VoipStunt.<br/><br/>Una volta installato e configurato openwrt per le proprie esigenze (lan, wifi, provider adsl.....) questi sono i primi passi da fare:<br/>1) entrare tramite interfaccia web alla pagina di configurazione di openwrt (indirizzo di default <a href="http://192.168.1.1/" target="_blank">http://192.168.1.1</a>)<br/>2) andare nel menu Sistema-programmi installati<br/>3) aggiornare per prima cosa la lista dei programmi tramite il link "aggiorna la lista dei pacchetti"<br/>3) installare asterisk<br/><br/>A questo punto accedere al router tramite SSH e configurare asterisk.<br/><br/>1) entrare nella cartella di asterisk <font color="Red">cd /etc/asterisk</font><br/>2) editare il file sip.conf (usare <font color="Red">vi sip.conf</font>; una volta terminato usare !wq per salvare e uscire)<br/><blockquote><em>[general]</em><br/><em> context=default</em><br/><em> port=5060</em><br/><em> bindaddr=0.0.0.0</em><br/><em> srvlookup=yes</em><br/><em> </em><br/><em> [100]</em><br/><em> context=telefono1</em><br/><em> type=friend</em><br/><em> host=dynamic</em><br/><em> username=100</em><br/><br/><em> [101]</em><br/><em> context=telefono2</em><br/><em> type=friend</em><br/><em> host=dynamic</em><br/><em> username=101</em><br/><em> </em><br/><em> [voipstunt]</em><br/><em> type=friend</em><br/><em> host=connectionserver.voipstunt.com</em><br/><em> disallow=all</em><br/><em> allow=ulaw</em><br/><em> allow=alaw</em><br/><em> allow=g729</em><br/><em> username=userid</em><br/><em> fromuser=userid</em><br/><em> secret=password</em><br/><em> qualify=1000</em><br/><em> canreinvite=no</em></blockquote><br/>3) editare il file extensions.conf (come sopra)<br/><blockquote><em>[general]</em><br/><em> static=yes</em><br/><em> writeprotect=no</em><br/><em> </em><br/><em> [globals]</em><br/><em> CONSOLE=Console/dsp</em><br/><em> IAXINFO=guest</em><br/><em> TRUNK=Zap/g2</em><br/><em> TRUNKMSD=1</em><br/><em> </em><br/><em> [iaxtel700]</em><br/><em> exten =&gt; _91700XXXXXXX,1,Dial(IAX2/${IAXINFO}@iaxtel.com/${EXTEN:1}@iaxtel)</em><br/><em> </em><br/><em> [iaxprovider]</em><br/><em> </em><br/><em> </em><br/><em> [pstn]</em><br/><em> exten =&gt; _01.,1,Dial(CAPI/contr1/b${EXTEN:2})</em><br/><em> exten =&gt; _02.,1,Dial(TAPI/g1/${EXTEN:2})</em><br/><em> </em><br/><em> [trunkint]</em><br/><em> exten =&gt; _9011.,1,Dial(${TRUNK}/${EXTEN:${TRUNKMSD}})</em><br/><em> exten =&gt; _9011.,2,Congestion</em><br/><em> </em><br/><em> [trunkld]</em><br/><em> exten =&gt; _91NXXNXXXXXX,1,Dial(${TRUNK}/${EXTEN:${TRUNKMSD}})</em><br/><em> exten =&gt; _91NXXNXXXXXX,2,Congestion</em><br/><em> </em><br/><em> [trunklocal]</em><br/><em> exten =&gt; _9NXXXXXX,1,Dial(${TRUNK}/${EXTEN:${TRUNKMSD}})</em><br/><em> exten =&gt; _9NXXXXXX,2,Congestion</em><br/><em> </em><br/><em> [trunktollfree]</em><br/><em> exten =&gt; _91800NXXXXXX,1,Dial(${TRUNK}/${EXTEN:${TRUNKMSD}})</em><br/><em> exten =&gt; _91800NXXXXXX,2,Congestion</em><br/><em> exten =&gt; _91888NXXXXXX,1,Dial(${TRUNK}/${EXTEN:${TRUNKMSD}})</em><br/><em> exten =&gt; _91888NXXXXXX,2,Congestion</em><br/><em> exten =&gt; _91877NXXXXXX,1,Dial(${TRUNK}/${EXTEN:${TRUNKMSD}})</em><br/><em> exten =&gt; _91877NXXXXXX,2,Congestion</em><br/><em> exten =&gt; _91866NXXXXXX,1,Dial(${TRUNK}/${EXTEN:${TRUNKMSD}})</em><br/><em> exten =&gt; _91866NXXXXXX,2,Congestion</em><br/><em> </em><br/><em> [international]</em><br/><em> ignorepat =&gt; 9</em><br/><em> include =&gt; longdistance</em><br/><em> include =&gt; trunkint</em><br/><em> </em><br/><em> [longdistance]</em><br/><em> ignorepat =&gt; 9</em><br/><em> include =&gt; local</em><br/><em> include =&gt; trunkld</em><br/><em> </em><br/><em> [local]</em><br/><em> ignorepat =&gt; 9</em><br/><em> include =&gt; parkedcalls</em><br/><em> include =&gt; trunklocal</em><br/><em> include =&gt; iaxtel700</em><br/><em> include =&gt; trunktollfree</em><br/><em> include =&gt; iaxprovider</em><br/><em> </em><br/><em> [macro-stdexten];</em><br/><em> exten =&gt; s,1,Dial(${ARG2},20)</em><br/><em> exten =&gt; s,2,Goto(s-${DIALSTATUS},1)</em><br/><em> exten =&gt; s-NOANSWER,1,Voicemail(u${ARG1})</em><br/><em> exten =&gt; s-NOANSWER,2,Goto(default,s,1)</em><br/><em> exten =&gt; s-BUSY,1,Voicemail(b${ARG1})</em><br/><em> exten =&gt; s-BUSY,2,Goto(default,s,1)</em><br/><em> exten =&gt; _s-.,1,Goto(s-NOANSWER,1)</em><br/><em> exten =&gt; a,1,VoicemailMain(${ARG1})</em><br/><em> </em><br/><em> [demo]</em><br/><em> exten =&gt; s,1,Wait,1</em><br/><em> exten =&gt; s,2,Answer</em><br/><em> exten =&gt; s,3,DigitTimeout,5</em><br/><em> exten =&gt; s,4,ResponseTimeout,10</em><br/><em> exten =&gt; s,5,BackGround(demo-congrats)</em><br/><em> exten =&gt; s,6,BackGround(demo-instruct)</em><br/><em> exten =&gt; 2,1,BackGround(demo-moreinfo)</em><br/><em> exten =&gt; 2,2,Goto(s,6)</em><br/><em> exten =&gt; 3,1,SetLanguage(fr)</em><br/><em> exten =&gt; 3,2,Goto(s,5)</em><br/><em> exten =&gt; 1000,1,Goto(default,s,1)</em><br/><em> exten =&gt; 1234,1,Playback(transfer,skip)</em><br/><em> exten =&gt; 1234,2,Macro(stdexten,1234,${CONSOLE})</em><br/><em> exten =&gt; 1235,1,Voicemail(u1234)</em><br/><em> exten =&gt; 1236,1,Dial(Console/dsp)</em><br/><em> exten =&gt; 1236,2,Voicemail(u1234)</em><br/><em> include =&gt; internal</em><br/><em> exten =&gt; #,1,Playback(demo-thanks)</em><br/><em> exten =&gt; #,2,Hangup</em><br/><em> exten =&gt; t,1,Goto(#,1)</em><br/><em> exten =&gt; i,1,Playback(invalid)</em><br/><em> exten =&gt; 500,1,Playback(demo-abouttotry)</em><br/><em> exten =&gt; 500,2,Dial(IAX2/guest@misery.digium.com/s@default)</em><br/><em> exten =&gt; 500,3,Playback(demo-nogo)</em><br/><em> exten =&gt; 500,4,Goto(s,6)</em><br/><em> exten =&gt; 600,1,Playback(demo-echotest)</em><br/><em> exten =&gt; 600,2,Echo</em><br/><em> exten =&gt; 600,3,Playback(demo-echodone)</em><br/><em> exten =&gt; 600,4,Goto(s,6)</em><br/><em> exten =&gt; 8500,1,VoicemailMain</em><br/><em> exten =&gt; 8500,2,Goto(s,6)</em><br/><em> </em><br/><em> [internal]</em><br/><em> exten =&gt; 3000,1,Dial(SIP/3000,30,Ttm)</em><br/><em> exten =&gt; 3000,2,Playback(invalid)</em><br/><em> exten =&gt; 3000,3,Hangup</em><br/><em> exten =&gt; 3000,102,Voicemail(u3000)</em><br/><em> exten =&gt; 3000,103,Hangup</em><br/><em> exten =&gt; 3001,1,Dial(SIP/3001,30,Ttm)</em><br/><em> exten =&gt; 3001,2,Playback(invalid)</em><br/><em> exten =&gt; 3001,3,Hangup</em><br/><em> exten =&gt; 3001,102,Voicemail(u3001)</em><br/><em> exten =&gt; 3001,103,Hangup</em><br/><em> exten =&gt; 3002,1,Dial(IAX2/3002,30,Ttm)</em><br/><em> exten =&gt; 3002,2,Playback(invalid)</em><br/><em> exten =&gt; 3002,3,Hangup</em><br/><em> exten =&gt; 3002,102,Voicemail(u3002)</em><br/><em> exten =&gt; 3002,103,Hangup</em><br/><em> exten =&gt; 3003,1,Dial(IAX2/3003,30,Ttm)</em><br/><em> exten =&gt; 3003,2,Playback(invalid)</em><br/><em> exten =&gt; 3003,3,Hangup</em><br/><em> exten =&gt; 3003,102,Voicemail(u3003)</em><br/><em> exten =&gt; 3003,103,Hangup</em><br/><em> </em><br/><em> [default]</em><br/><em> include =&gt; demo</em><br/><em> include =&gt; parkedcalls</em><br/><em> include =&gt; pstn</em><br/><em> include =&gt; internal</em><br/><em> </em><br/><em> </em><br/><em> exten =&gt; 99990,1,Answer</em><br/><em> exten =&gt; 99990,2,AGI(agi-test.agi)</em><br/><em> exten =&gt; 99990,3,Hangup</em><br/><em> exten =&gt; 99991,1,Answer</em><br/><em> exten =&gt; 99991,2,EAGI(eagi-test)</em><br/><em> exten =&gt; 99991,3,Hangup</em><br/><em> exten =&gt; 99992,1,Answer</em><br/><em> exten =&gt; 99992,2,Wait(1)</em><br/><em> exten =&gt; 99992,3,SayUnixTime()</em><br/><em> exten =&gt; 99992,4,Hangup</em><br/><em> exten =&gt; 99999,1,Answer</em><br/><em> exten =&gt; 99999,2,Wait(1)</em><br/><em> exten =&gt; 99999,3,MusicOnHold</em><br/><em> </em><br/><em> [incoming]</em><br/><em> exten =&gt; s,1,Dial(SIP/100,30,tr)</em><br/><em> </em><br/><em> [telefono1]</em><br/><em> include =&gt; demo</em><br/><em> include =&gt; outcoming</em><br/><em> </em><br/><em> [telefono2]</em><br/><em> include =&gt; demo</em><br/><em> include =&gt; outcoming</em><br/><br/><em> [outcoming]</em><br/><em> exten =&gt; _X.,1,Dial(SIP/${EXTEN:0}@voipstunt,30,tr)</em></blockquote><br/>4) editare il file asterisk nella cartella /etc/default modificare il parametro ENABLE_ASTERISK="no" in ENABLE_ASTERISK="yes" per far partire asterisk in automatico all'avvio del router.<br/><br/>A questo punto e' possibile configurare 2 softphone/telefoni VoIP, assegnando gli interni 100 e 101: i due telefoni possono dialogare ed effettuare chiamate esterne appoggiandosi su VoipStunt.<br/><br/>Se poi avete a disposizione un numero geografico registrato con servizi come <a href="http://www.skypho.net/" title="Skypho">Skypho</a>  , seguendo <a href="http://www.skypho.net/download/asterisk.html" title="queste istruzioni">queste istruzioni</a> sara' possibile configurare il PBX per accettare telefonate in ingresso e inoltrarle agli interni precedentemente configurati.