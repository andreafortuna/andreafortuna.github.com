---
layout: post
title: Rimuovere da Active Directory un Domain Controller Off-Line
date: '2006-02-22T00:17:00.001+01:00'
author: Andrea Fortuna
tags:
- Microsoft
modified_time: '2012-04-26T14:23:57.515+02:00'
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-2401983300691398424
blogger_orig_url: http://www.andreafortuna.org/2006/02/rimuovere-da-active-directory-un-domain_21.html
---

<p>Puo' capitare (spero non spesso!) che in un dominio Active Directory un Domain Controller vada in crash, e per un qualsiasi motivo si decida di non reintegrarlo o sostituirlo con un altro.</p><p>A questo punto si pone il problema di rimuovere il DC da AD, senza pero' poter&nbsp;richiamare <em>dcpromo</em> ed effettuare il declassamento direttamente dal Domain Controller interessato (si presume che non si avvii).</p><a name='more'></a><p>A questa problematica si puo' ovviare rimuovendo da AD i meta-data del Domain Controller 'morto'.</p><p>La procedura e' la seguente:</p><p>&bull; Autenticarsi con un account avente diritti Enterprise Admins.<br />&bull; Aprire una sessione Command Prompt ed eseguire il comando NTDSUTIL.<br />&bull; Al prompt di NTDSUTIL, inserire il comando Metadata cleanup (o le iniziali m c).<br />&bull; Dal prompt &ldquo;Metadata cleanup&rdquo; inserire il comando &ldquo;connections&rdquo;.<br />&bull; Dal prompt &ldquo;Connections&rdquo; inserire il comando &ldquo;connect to server &lt;nomeDC&gt;&rdquo; (e.g.: connect to server ls-mi-dc-01).<br />&bull; Digitare quit per uscire dal contesto &ldquo;Connections&rdquo;.<br />&bull; Dal prompt &ldquo;Metadata cleanup&rdquo; inserire il comando &ldquo;Select operation target&rdquo;.<br />&bull; Dal prompt &ldquo;Select operation target&rdquo; inserire il comando &ldquo;List domains&rdquo;.<br />&bull; Identificare il numero del dominio di cui faceva parte il DC da rimuovere ed inserire il comando: select domain &lt;NumeroDominio&gt; (e.g.: select domain 0).<br />&bull; Dal prompt &ldquo;Select operation target&rdquo; inserire il comando &ldquo;List sites&rdquo;.<br />&bull; Identificare il numero del site di cui faceva parte il DC da rimuovere ed inserire il comando: select site &lt;NumeroSite&gt; (e.g.: select site 0).<br />&bull; Dal prompt &ldquo;Select operation target&rdquo; inserire il comando &ldquo;List servers in site&rdquo;.<br />&bull; Identificare il numero del server/DC da rimuovere ed inserire il comando: select server &lt;NumeroServer&gt; (e.g.: select server 1).<br />&bull; Uscire dal contesto &ldquo;Select operation target&rdquo; inserendo il comando quit.<br />&bull; Dal prompt &ldquo;Metadata cleanup&rdquo; inserire il comando &ldquo;Remove selected server&rdquo; e confermare l&rsquo;operazione cliccando sul bottone Yes all&rsquo;interno della finestra &ldquo;Server Remove Confirmation Dialog&rdquo;.<br />&bull; Uscire dal contesto &ldquo;Metadata cleanup&rdquo; inserendo il comando quit.<br />&bull; Digitare quit per uscire dal comando NTDSUTIL.<br />&bull; Mediante lo snap-in ADSI Edit rimuovere tutte le entry relative al DC in questione dai seguenti container (corrispondenti al dominio ed al site di appartenenza del DC che sono stati utilizzati nella procedura NTDSUTIL)<br />&nbsp;&nbsp;&nbsp;&nbsp; OU=Domain Controllers,&lt;DominioCheContenevaDC&gt;.<br />&nbsp;&nbsp;&nbsp;&nbsp; CN=Servers,CN=&lt;SiteCheContenevaDC&gt;,CN=Sites,CN=Configuration,&lt;DN-ForestRootDomain&gt;<br />&bull; Mediante lo snap-in DNS eliminare da tutte le zone (compreso la zona _msdcs.&lt;FQDN-Dominio&gt;) gli eventuali resource record DNS SRV, A e PTR riferiti al DC eliminato da AD.</p>