---
layout: post
title: 'Titanium Mobile: download di aggiornamenti in background'
date: '2012-04-03T13:00:00.001+02:00'
author: Andrea Fortuna
tags:
- caching
- Appcelerator
- snippets
- Programmazione
- titanium
modified_time: '2012-04-26T14:20:17.444+02:00'
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-1610958068162745048
blogger_orig_url: http://oldsite.andreafortuna.org/2012/04/titanium-mobile-download-di_8048.html
---

Un rapido snipped di codice che permette di gestire l'aggiornamento <em>over-the-air</em> di file presenti all'interno della nostra app:<br/><br/>[sourcecode language="java"]<br/>function getFile(filename) {<br/>	Ti.API.info(&quot;Carico file&quot; + filename + &quot;.txt&quot;);<br/>	var f = Titanium.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, filename + '.txt');<br/>	var contents = f.read();<br/>	contents = contents.text;<br/>	if(Titanium.Network.networkType != Titanium.Network.NETWORK_NONE) {<br/>		//Scarico cache<br/>		Ti.API.info(&quot;scarico cache&quot;);<br/>		var xhr = Titanium.Network.createHTTPClient();<br/>		xhr.open(&quot;GET&quot;, &quot;http://[SERVER DI PROVISIONING]/&quot; + filename + &quot;.txt&quot;);<br/>		xhr.onload = function() {<br/>			statusCode = xhr.status;<br/>			if(statusCode == 200) {<br/>				var doc = this.responseText;<br/>				Ti.API.info(doc);<br/>				var f = Titanium.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, filename + '.txt');<br/>				Ti.API.info(&quot;ELIMINO VECCHIO FILE:&quot; + f.deleteFile());<br/>				f.write(doc);<br/>			}<br/>		};<br/>		xhr.send();<br/>	}<br/>	return contents;<br/>}<br/>[/sourcecode]<br/><br/>I file devono essere già presenti nella location <strong>Ti.Filesystem.applicationDataDirectory</strong>: la cosa migliore da fare è copiarli nella cartella <em>Resources</em> del progetto (io utilizzo una directory <em>archivi</em> nella quale metto tutti gli archivi 'di default') e copiarli in <strong>applicationDataDirectory</strong> con questa semplice funzione:<br/><br/>[sourcecode language="java"]<br/>function copyFile(filename) {<br/>	var fromFile = Titanium.Filesystem.getFile(Ti.Filesystem.resourcesDirectory, 'archivi/' + filename + '.txt');<br/>	var contenuto = fromFile.read()<br/>	var toFile = Titanium.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, filename + '.txt');<br/>	if(toFile.exists() === false)<br/>		toFile.write(contenuto);<br/>}<br/>[/sourcecode]<br/><br/>La funzione getFile non fa altro che prelevare il file dal path passato come parametro e restituirlo, contestualmente verifica se è presente una connessione di rete disponibile e inizia a scaricare in background una nuova versione del file (dall'indirizzo specificato con [SERVER DI PROVISIONING]).A download terminato lo sostituisce a quello attualmente in uso.<br/><br/>Al successivo avvio dell'applicazione, i dati saranno aggiornati.