---
layout: post
title: 'SMS Spoofing: modificare il mittente di un SMS'
date: '2007-05-31T15:38:00.001+02:00'
author: Andrea Fortuna
tags:
- Hacking
modified_time: '2013-05-22T09:30:52.822+02:00'
thumbnail: http://2.bp.blogspot.com/-_caqkiEHJ5Y/UZx0CG8DhaI/AAAAAAAAEw8/XbP3h_XMPAE/s72-c/sms_phishing-11399052.jpg
blogger_id: tag:blogger.com,1999:blog-1948348952555789070.post-7888246080907341865
blogger_orig_url: http://oldsite.andreafortuna.org/2007/05/sms-spoofing-modificare-il-mittente-di_31.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-_caqkiEHJ5Y/UZx0CG8DhaI/AAAAAAAAEw8/XbP3h_XMPAE/s1600/sms_phishing-11399052.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="133" src="http://2.bp.blogspot.com/-_caqkiEHJ5Y/UZx0CG8DhaI/AAAAAAAAEw8/XbP3h_XMPAE/s200/sms_phishing-11399052.jpg" width="200" /></a></div>Alla luce dell'interesse riscontrato nei confronti del <a href="http://andreafortuna.wordpress.com/2007/05/26/digilab-e-spoofing-telefonico-la-scoperta-dellacqua-calda/">precedente articolo</a> nel quale spiegavo la procedura per modificare il CallerID di una telefonata (procedura usata da Alessandro Marzini nell'ormai famosa intervista a SkyTg24), ritorno sull'argomento spiegando come sia tecnicamente possibile modificare il mittente di un SMS.<br /><br /><br />Prima di tutto, un po' di storia...:-)<br /><br /><a name='more'></a><br /><br /><a href="http://andreafortuna.files.wordpress.com/2007/05/gsm_network.png" title="gsm_network.png"><img align="right" alt="gsm_network.png" border="0" hspace="9" src="http://andreafortuna.files.wordpress.com/2007/05/gsm_network.thumbnail.png" vspace="2" /></a>Nel 1990 l'<a href="http://en.wikipedia.org/wiki/ETSI">European Telecommunication Standards Institute</a> pubblico' le specifiche dell'allora nuovo sistema <a href="http://en.wikipedia.org/wiki/GSM">GSM</a>. In queste specifiche venne introdotto un sotto-protocollo, inizialmente poco conosciuto in quanto poco pubblicizzato.<br />Nessuno degli addetti ai lavori, nei primi anni '90, avrebbe mai immaginato che un servizio per l'invio di <em>brevi messaggi di testo</em> (Short Message Service, appunto SMS)  avrebbe avuto tanto successo in futuro.<br />Ideato inizialmente come servizio per la diffusione di broadcast delle informazioni, aveva infatti anche la possibilità di inviare brevi messaggi tra i terminali: nessuno ci credeva, in quanto sembrava troppo complicato (e snervante!) scrivere un messaggio utilizzando esclusivamente i tasti di un cellulare (e il T9 non era ancora nemmeno all'orizzonte!).<br /><br />Cos'è quindi un SMS? Si tratta di un semplice messaggio di testo di massimo 160 caratteri, in formato 7 bit.<br />Vengono scambiati tra cellulare e SMSC (Short Message Service Center) e fra SMSC; vengono spediti utilizzando il canale di segnalazione, permettendone quindi la ricezione anche quando i canali voce/dati sono già impegnati.<br /><br />Vengono ricevuti dal terminale corredati da una serie di dati 'accessori': oltre (ovviamente) al testo del messaggio, il SMSC invia al cellulare tra le altre cose  anche il numero del mittente e il numero del gateway utilizzato.<br />Nel protocollo tuttavia non è inserito alcun sistema di autenticazione, per cui non è possibile avere la certezza che il numero del mittente sia davvero quello ricevuto: il mittente infatti viene inviato dal terminale stesso all'SMSC, e c'e' effettivamente modo di modificarlo.<br /><br />Attingo quindi a piene mani da un'articolo pubblicato da  Jack McKrak sul numero 8 del 30/04/2000 della storica e-zine <a href="http://www.s0ftpj.org/bfi/bfi-it.html">Butchered From Inside</a>, nel quale si tratta proprio di SMS Spoofing e delle tecniche per l' implementazione dello stesso.<br /><br />Iniziamo con una premessa<br /><blockquote>Spesso gli operatori<br />di telefonia mobile offrono il servizio di invio sms tramite appositi<br />SMS-Gateway raggiungibili via modem. Sono la stessa cosa dei vari servizi<br />presenti su internet, solo che in questo caso non devi compilare una form web,<br />ma ti colleghi via telefono e ottieni il servizio attraverso un protocollo di<br />comunicazione. [di protocolli] se ne usano principalmente due: il TAP e l'UCP.</blockquote><br />E l'UCP e' quello vulnerabile a tecniche di spoofing. Tuttavia i gateway disponibili che utilizzano l'UCP sono sempre meno. :-P<br /><br />Nel protocollo UCP<br /><blockquote>si<br />invia una trama formattata in questo modo:<br /><br />&lt;STX&gt; HDR DATA CRC &lt;ETX&gt;<br /><br />dove &lt;STX&gt; e &lt;ETX&gt; sono i caratteri di start-stop rispettivamente 02h e 03h.<br /><br />L'header (HDR) contiene alcuni sottocampi separati dal carattere '/'<br /><br />TRN/LNG/OR/OPN<br /><br />TRN [2 NUMERIC CHAR] e' il numero della transizione (casuale) e varia<br />fra 0 e 99<br />LNG [5 NUMERIC CHAR] la lunghezza della trama ovvero quanti caratteri ci sono<br />fra &lt;ETX&gt; e &lt;STX&gt;<br />OR  [1 CHAR]         puo' essere il carattere 'O' che indica la richiesta di<br />servizio o il carattere 'R' che indica risposta a una<br />richiesta<br />OT  [2 NUMERIC CHAR] e' il codice dell'operazione richiesta ed e' il parametro<br />piu' interessante.<br /><br />La lista dei servizi e' elencata (come del resto tutti gli altri parametri<br />tecnici) nel doc di definizione del protocollo UCP che e' compreso nel<br />documento "ETS 133-3" prodotto dall'ETSI, ovvero l'ente che in europa si<br />occupa di gran parte degli standard in materia di telecomunicazioni.<br /><br />I servizi piu' interessanti alla fine pero' sono due: lo 01 e lo 02.<br /><br />01 Invio di un singolo SMS<br />02 Invio di un SMS multiplo<br /><br />Esempio di header 01/00020/O/01<br /><br />Il campo DATA varia da servizio a servizio. Per lo 01 e' composto da questi<br />sottocampi:<br /><br />AdC/OAdC/OAC/MT/AMsg<br /><br />AdC  [STRING OF NUM CHAR] E' il numero del destinatario del messaggio<br />visto che di solito i gateway sono fuori dall'italia<br />il numero e' meglio scriverlo ad esempio come:<br />0039347000000 dove 0039 e' sempre presente<br />OAdC [STRING OF NUM CHAR] E qui casca l'asino! Questo e' il numero sorgente<br />del messaggio! Qui potete metterci qualsiasi serie<br />di caratteri fra 0 e 9. Anche tipo 666 o 123456 o<br />0000000.<br />Se pero' notate i messaggi autentici indicano il<br />numero del mittente come +39ecc. Purtroppo il '+'<br />non si riesce a mettere e i vostri messaggi al<br />massimo possono arrivare da un 0039ecc.<br />OAC  [STRING OF CHAR]     Codice di autentificazione del mittente. Non so a<br />che cazzo serva. Va lasciato in bianco.<br />MT   [1 NUM CHAR]         Tipo di messaggio. Qui va messo sempre 3 che indica<br />un messaggio alfanumerico.<br />AMsg [STRING OF CHAR]     Il messaggio vero e proprio.<br /><br />Per l'AMsg va fatta una piccola digressione. Il testo non e' scritto in<br />chiaro, ma va codificato in stringhe IA5: si tratta di scrivere i caratteri con la loro codifica ascii<br />invece che in chiaro. Questo perche' gli ingegneri che hanno<br />redatto il protocollo volevano inserire un controllo di errore in piu' visto<br />che per inviare un carattere cosi' bisogna mandarne due.<br /><br />Cosa forse inutile, visto che l'ultimo campo CRC e' un controllo di errore.<br />Questo paramentro sono due caratteri che costituiscono un numero in<br />esadecimale. Il numero si ottiene prendendo le ultime due cifre significative<br />(esadecimali) o della somma di tutti i caratteri che compongono header e data.</blockquote><br />Fatta questa premessa, utilizzando un software che appoggiandosi a uno di questi gateway possa inviare messaggi, e modificandolo opportunamente in modo da inviare un OAdC modificato, possiamo inviare SMS con un mittente a nostra scelta.<br /><br />Il software preso in esame e' <a href="http://www.smsclient.org/">SMSClient</a>, un client per l'invio di sms sviluppato per linux e rilasciato sotto licenza Gpl, quindi con il sorgente disponibile e modificabile.<br /><br />Una volta scaricato il sorgente si <a href="http://www.smsclient.org/download/smsclient-2.0.8/">SMSClient 2.0.8</a>, sara' necessario sostituire il file ucp.c presente nella directory /src/driver con <a href="http://www.s0ftpj.org/tools/ucp.c">questa versione</a>. Un bel make e make install e salvo imprevisti il programma e' pronto per essere utilizzato.<br /><br />Piccolo appunto sulla configurazione:<br /><blockquote>C'e' anche una sottodir 'services', dentro questa<br />ci sono i file che corrispondono ai gateway sms sparsi per il mondo.<br />Ovviamente ce ne sono solo alcuni e per giunta quelli piu' conosciuti.<br />Questo implica che sono quelli piu' usati e che solitamente lasciano meno<br />possibilita' di smanettare e di divertirsi. Sta a voi recuperare altri numeri<br />di qualche gateway piu' disponibile.<br />Spesso per fare andare il prog cambiate il '+' nel numero del gateway<br />impostato in questi file con '00' da chiamata internazionale (okkio a non<br />stare collegati troppo, nell 99% dei casi chiamate qualche paese estero).</blockquote><br />E ora le direttive sull'utilizzo:<br /><blockquote>Ora siamo pronti per mandare un messaggio, manca solo da editare il file<br />'codice' Questo file e' usato dalla mia modifica di ucp.c per poter mandare<br />comandi qualunque al gateway, senza passare dalle ridotte opzioni di<br />sms_client.<br /><br />Create il file 'codice'.<br /><br />In questo file va messa una parte del campo HEADER e del campo DATA dell'sms<br />che volete inviare. Dell'header solo il campo OT, del data tutto tranne AMasg.<br /><br />Ovvero, rifacendosi al messaggio 'Satana ti vede', dentro il file 'codice' va<br />messa questa riga di testo:<br /><br />01/0039347123456/666//3<br /><br />Salva il file. Ora spostalo nella dir dove e' presente l'eseguibile sms_client<br />e batti<br /><br />./sms_client d2:0 'Satana ti vede'<br /><br />In questo caso Il nostro pc telefonera' al gateway di d2 (file definito nella<br />dir /etc/sms/services) e cerchera' di mandare il messaggio secondo quello che<br />e' scritto nel file 'codice'. Il programma vi fara' vedere cosa combina passo<br />per passo e se tutto e' andato a buon fine qualche vostro amico potrebbe<br />riconsiderare "L'Esorcista".<br /><br />Per mandare un sms multiplo il nostro file codice dovra' contenere ad esempio<br />la riga<br /><br />02/3/0039347123456/0039347543210/0039347234765/666//3<br /><br />e partiranno 3 sms con un'unica chiamata.<br /><br />Un sms bombing sara' invece cosi'<br /><br />02/20/0039347123456/0039347123456/0039347123456/0039347123456/0039347123456/<br />... eccetera</blockquote><br />per i dettagli vi rimanto all'<a href="http://www.s0ftpj.org/bfi/online/bfi9/BFi09-15">articolo completo di  Jack McKrak</a> che, vi faccio notare, risale al lontano anno 2000!  (giusto per ribadire il concetto di '<em>Scoperta dell'acqua calda</em>') :-D